(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{412:(e,t,a)=>{"use strict";a.d(t,{db:()=>i,j:()=>c});var l=a(3915),s=a(6203),n=a(5317);let r=(0,l.Wp)({apiKey:"AIzaSyDQYG6oeKY6Yqb-uGIighhpB9kPZOliXKI",authDomain:"friends-travel-3ea70.firebaseapp.com",projectId:"friends-travel-3ea70",storageBucket:"friends-travel-3ea70.firebasestorage.app",messagingSenderId:"435646682540",appId:"1:435646682540:web:b98cee8f8a44915a9d1609",measurementId:"G-564Y94G6RX"}),i=(0,n.aU)(r),c=(0,s.xI)(r)},1660:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,AuthProvider:()=>d});var l=a(5155),s=a(2115),n=a(6203),r=a(5695),i=a(412);let c=(0,s.createContext)({userEmail:null,userId:null,loading:!0}),o=()=>(0,s.useContext)(c),d=e=>{let{children:t}=e,[a,o]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0),x=(0,r.useRouter)();return(0,s.useEffect)(()=>{let e=(0,n.hg)(i.j,e=>{e?(o(e.email),h(!1),u(e.uid)):x.push("/login")});return()=>e()},[x]),(0,l.jsx)(c.Provider,{value:{userEmail:a,userId:d,loading:m},children:t})}},3989:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var l=a(5594),s=a(376),n=a(7414),r=a(5155),i=a(9688);let c=e=>{var{children:t,className:a,variant:c="default"}=e,o=(0,n._)(e,["children","className","variant"]);return(0,r.jsx)("button",(0,s._)((0,l._)({},o),{className:(0,i.QP)("".concat("px-4 py-2 rounded"," ").concat({default:"bg-blue-500 text-white hover:bg-blue-600",text:"text-blue-500 hover:underline"}[c]," ").concat(a)),children:t}))}},4239:(e,t,a)=>{Promise.resolve().then(a.bind(a,8279))},8279:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var l=a(5155),s=a(2115),n=a(1660),r=a(5594),i=a(7414);let c=e=>{var{checked:t,onChange:a,className:s}=e,n=(0,i._)(e,["checked","onChange","className"]);return(0,l.jsxs)("label",{className:"inline-flex items-center cursor-pointer ".concat(null!=s?s:""),children:[(0,l.jsx)("input",(0,r._)({type:"checkbox",checked:t,onChange:a,className:"sr-only peer"},n)),(0,l.jsx)("div",{className:"w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-blue-500 transition-all"}),(0,l.jsx)("div",{className:"absolute w-5 h-5 bg-white rounded-full shadow transform peer-checked:translate-x-full transition-transform"})]})};var o=a(412),d=a(6203),u=a(3989);let m=()=>{let e=async()=>{try{await (0,d.CI)(o.j)}catch(e){console.error("Błąd wylogowania:",e)}};return(0,l.jsxs)("div",{className:"flex justify-between w-full items-center p-4 md:flex-col md:justify-between md:h-full",children:[(0,l.jsx)("div",{}),(0,l.jsx)(u.$,{className:"bg-neutral-0 hover:bg-neutral-300 ml-auto md:ml-0",onClick:e,children:(0,l.jsx)("p",{className:"text-blue-500",children:"Logout"})})]})},h=(e,t)=>new Date(t,e+1,0).getDate(),x=(e,t)=>{let a=h(e,t),l=(new Date(t,e,1).getDay()+6)%7,s=[],n=0===e?11:e-1,r=0===e?t-1:t,i=11===e?0:e+1,c=11===e?t+1:t,o=h(n,r)-l+1,d=1,u=1;for(let m=0;m<6;m++){let h=[];for(let s=0;s<7;s++)0===m&&s<l?h.push({day:o++,isCurrentMonth:!1,month:n,year:r}):d>a?h.push({day:u++,isCurrentMonth:!1,month:i,year:c}):h.push({day:d++,isCurrentMonth:!0,month:e,year:t});s.push(h)}return s},f=e=>"".concat(String(e.getDate()).padStart(2,"0"),".").concat(String(e.getMonth()+1).padStart(2,"0"),".").concat(e.getFullYear()),g=e=>{let{markedDates:t,tempMarkedDates:a=[],densityMap:n=null,onDayPress:r,onDayHover:i,onContextMenuDay:c}=e,[o,d]=(0,s.useState)(new Date().getMonth()),[u,m]=(0,s.useState)(new Date().getFullYear()),[h,g]=(0,s.useState)("day"),y=Array.from({length:96},(e,t)=>2001+t),p=(0,s.useRef)(null),b=new Date;(0,s.useEffect)(()=>{if("year"===h&&p.current){let e=y.indexOf(u),t=Math.floor(e/3)-(e%3==2?3:2);p.current.scrollTo({top:60*t,behavior:"auto"})}},[h,u,y]);let v=e=>{r(new Date(e.year,e.month,e.day))},w=e=>{i&&i(new Date(e.year,e.month,e.day))},j=e=>{d(t=>"prev"===e?0===t?(m(e=>e-1),11):t-1:11===t?(m(e=>e+1),0):t+1)},N=new Set(null==t?void 0:t.map(f)),D=new Set(null==a?void 0:a.map(f));return(0,l.jsxs)("div",{className:"bg-white p-6 w-fit rounded-lg text-center shadow-md border border-gray-300",children:[(0,l.jsxs)("div",{className:"mb-4",children:["day"===h&&(0,l.jsxs)("div",{className:"flex justify-between items-center w-full gap-4",children:[(0,l.jsx)("button",{onClick:()=>j("prev"),className:"text-blue-600 text-xl",children:"◀"}),(0,l.jsx)("button",{onClick:()=>g("month"),className:"font-semibold text-xl text-black",children:new Date(u,o).toLocaleString("default",{month:"long",year:"numeric"})}),(0,l.jsx)("button",{onClick:()=>j("next"),className:"text-blue-600 text-xl",children:"▶"})]}),"day"!==h&&(0,l.jsx)("button",{onClick:()=>g("year"),className:"text-black font-semibold text-xl",children:u})]}),(0,l.jsxs)("div",{className:"w-[80vw] max-w-[360px] aspect-square md:w-[360px]",children:["day"===h&&!n&&(()=>{let e=x(o,u);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex justify-between text-blue-600 font-semibold text-lg mb-2",children:["MON","TUE","WED","THU","FRI","SAT","SUN"].map(e=>(0,l.jsx)("div",{className:"w-12 h-12 flex items-center justify-center",children:e},e))}),e.map((e,t)=>(0,l.jsx)("div",{className:"flex justify-between",children:e.map((e,t)=>{let a=new Date(e.year,e.month,e.day),s=f(a),n=b.getFullYear()===e.year&&b.getMonth()===e.month&&b.getDate()===e.day,r=N.has(s);return(0,l.jsx)("div",{className:"w-12 h-12 text-lg rounded-full flex items-center justify-center cursor-pointer transition-all\n                    ".concat(e.isCurrentMonth?"text-black":"text-gray-400","\n                    ").concat(D.has(s)?"bg-blue-100":"","\n                    ").concat(r?"bg-blue-500 text-white":"","\n                    ").concat(n?"border-2 border-blue-700":""),onClick:()=>v(e),onMouseOver:()=>w(e),onContextMenu:e=>{e.preventDefault(),null==c||c(a,e)},"data-date":a.toDateString(),children:e.day},t)})},t))]})})(),"day"===h&&n&&(()=>{let e=x(o,u);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex justify-between text-blue-600 font-semibold text-lg mb-2",children:["MON","TUE","WED","THU","FRI","SAT","SUN"].map(e=>(0,l.jsx)("div",{className:"w-12 h-12 flex items-center justify-center",children:e},e))}),e.map((e,t)=>(0,l.jsx)("div",{className:"flex justify-between",children:e.map((e,t)=>{let a=new Date(e.year,e.month,e.day),s=a.toDateString(),r=b.getFullYear()===e.year&&b.getMonth()===e.month&&b.getDate()===e.day,i=(null==n?void 0:n[s])||0,o=Math.max(...Object.values(n||{}),1),d=i>0?Math.min(.2+i/o*.6,.85):0;return(0,l.jsx)("div",{style:{backgroundColor:d?"rgba(59, 130, 255, ".concat(d,")"):""},className:"w-12 h-12 text-lg rounded-full flex items-center justify-center cursor-pointer transition-all\n                    ".concat(e.isCurrentMonth?"text-black":"text-gray-400","\n                    ").concat(D.has(f(a))?"ring-2 ring-blue-300":"","\n                    ").concat(r?"border-2 border-blue-700":""),onClick:()=>v(e),onMouseOver:()=>w(e),onContextMenu:e=>{e.preventDefault(),null==c||c(a,e)},"data-date":a.toDateString(),children:e.day},t)})},t))]})})(),"month"===h&&(0,l.jsx)("div",{className:"grid grid-cols-3 gap-4",children:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map((e,t)=>(0,l.jsx)("div",{className:"w-24 h-16 text-lg flex items-center justify-center bg-gray-200 rounded cursor-pointer hover:bg-blue-200",onClick:()=>{d(t),g("day")},children:e},t))}),"year"===h&&(0,l.jsx)("div",{className:"max-h-80 overflow-y-auto",ref:p,children:(0,l.jsx)("div",{className:"grid grid-cols-3 gap-4",children:y.map(e=>(0,l.jsx)("div",{className:"w-24 h-16 text-lg flex items-center justify-center bg-gray-200 rounded cursor-pointer hover:bg-blue-200",onClick:()=>{m(e),g("month")},children:e},e))})})]})]})};var y=a(5317);async function p(e,t,a){let l=(0,y.H9)(o.db,"trips",e,"dateVotes",t),s=a.map(e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(l)});await (0,y.BN)(l,{UID:t,votes:s},{merge:!0})}async function b(e,t){let a=(0,y.H9)(o.db,"trips",e,"dateVotes",t),l=await (0,y.x7)(a);return l.exists()&&l.data().votes||[]}async function v(e){let t=(0,y.rJ)(o.db,"trips",e,"dateVotes"),a=await (0,y.GG)((0,y.P)(t)),l=[];for(let e of a.docs){let t=e.data(),a=t.UID,s="Użytkownik",n="";try{let e=await (0,y.x7)((0,y.H9)(o.db,"users",a));if(e.exists()){let t=e.data();s=t.firstName||s,n=t.lastName||n}}catch(e){console.warn("Nie udało się pobrać danych użytkownika ".concat(a,":"),e)}a&&Array.isArray(t.votes)&&l.push({uid:a,firstName:s,lastName:n,votes:t.votes})}return l}let w=()=>{let e=(0,n.A)(),[t,a]=(0,s.useState)([]),[r,i]=(0,s.useState)([]),[c,o]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{(null==e?void 0:e.userId)&&(a((await b("trip1",e.userId)).map(e=>new Date(e))),h(!0))})()},[e]),(0,s.useEffect)(()=>{(async()=>{(null==e?void 0:e.userId)&&m&&await p("trip1",e.userId,t)})()},[t,e,m]);let x=(e,t)=>e.toDateString()===t.toDateString(),f=e=>t.some(t=>x(t,e)),y=(e,t)=>{let a=[],l=new Date(e),s=e<t?1:-1;for(;1===s&&l<=t||-1===s&&l>=t;)a.push(new Date(l)),l.setDate(l.getDate()+s);return a},v=()=>{i([]),o(null),u(null)};return(0,l.jsx)(g,{markedDates:t,tempMarkedDates:r,onDayPress:e=>{let l=f(e);if(!c){o(e),i([e]),u(l?"deselecting":"selecting");return}let s=y(c,e);if("selecting"===d){let e=[...t];s.forEach(t=>{f(t)||e.push(t)}),a(e)}"deselecting"===d&&a(t.filter(e=>!s.some(t=>x(e,t)))),i([]),o(null),u(null)},onDayHover:e=>{d&&c&&i(y(c,e))},onContextMenuDay:()=>v()})},j=e=>{let{checked:t,onCheckedChange:a,className:s,children:n}=e,r=()=>{a(!t)};return(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:t,onChange:()=>r(),className:"w-4 h-4 cursor-pointer ".concat(s)}),(0,l.jsx)("p",{className:"text-black hover:cursor-pointer",onClick:()=>r(),children:n})]})},N=()=>{let[e,t]=(0,s.useState)([]),[a,n]=(0,s.useState)(new Set),[r,i]=(0,s.useState)([]),[c,o]=(0,s.useState)({}),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{let e=await v("trip1");t(e),n(new Set(e.map(e=>e.uid)))})()},[]),(0,s.useEffect)(()=>{let t=e.filter(e=>a.has(e.uid)),l={};t.forEach(e=>{e.votes.forEach(e=>{let t=new Date(e).toDateString();l[t]=(l[t]||0)+1})}),o(l),i(Object.keys(l).map(e=>new Date(e)))},[e,a]);let x=e=>{n(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})};return(0,l.jsxs)("div",{className:"flex flex-col md:flex-row items-start justify-center w-full",children:[(0,l.jsx)(g,{onDayPress:()=>{},onDayHover:e=>{var t;let a=null==(t=document.querySelector('[data-date="'.concat(e.toDateString(),'"]')))?void 0:t.getBoundingClientRect();a&&h({x:a.left+a.width/2,y:a.top}),u(e.toDateString())},markedDates:r,densityMap:c}),d&&m&&e.some(e=>e.votes.some(e=>new Date(e).toDateString()===d))&&(0,l.jsx)("div",{className:"absolute bg-white border shadow-md rounded px-4 py-2 text-sm z-50",style:{top:m.y-10,left:m.x,transform:"translate(-50%, -100%)"},onMouseLeave:()=>u(null),children:(0,l.jsx)("ul",{className:"mt-1",children:e.filter(e=>e.votes.some(e=>new Date(e).toDateString()===d)).map(e=>(0,l.jsxs)("li",{children:[e.firstName," ",e.lastName]},e.uid))})}),(0,l.jsxs)("div",{className:"mt-4 md:mt-0 md:ml-4 w-full max-w-sm",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Użytkownicy:"}),e.map(e=>(0,l.jsx)("div",{className:"flex items-center mb-2",children:(0,l.jsx)(j,{checked:a.has(e.uid),onCheckedChange:()=>x(e.uid),children:(0,l.jsxs)("span",{className:"ml-2 text-lg",children:[e.firstName," ",e.lastName]})})},e.uid))]})]})},D=()=>{let{loading:e}=(0,n.A)(),[t,a]=(0,s.useState)(!1);return e?(0,l.jsx)("div",{role:"status",className:"flex w-full items-center justify-center",children:(0,l.jsx)("svg",{"aria-hidden":"true",className:"w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600",viewBox:"0 0 100 101"})}):(0,l.jsxs)("section",{className:"flex flex-col md:flex-row w-full h-full",children:[(0,l.jsx)("div",{className:"md:order-2",children:(0,l.jsx)(m,{})}),(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full p-4 md:pl-4 md:order-1",children:[t?(0,l.jsx)(N,{}):(0,l.jsx)(w,{}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-4 gap-2",children:["Pokaż wszystkie głosy",(0,l.jsx)(c,{checked:t,onChange:()=>a(e=>!e)})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,163,75,807,441,684,358],()=>t(4239)),_N_E=e.O()}]);